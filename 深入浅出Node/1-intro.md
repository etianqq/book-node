## Node 简介

### Node是单线程的吗？

Node 中最核心的是 v8 引擎，在 Node 启动后，会创建 v8 的实例，这个实例是多线程的。

- 主线程：编译、执行代码。
- 编译/优化线程：在主线程执行的时候，可以优化代码。
- 分析器线程：记录分析代码运行时间，为 Crankshaft 优化代码执行提供依据。
- 垃圾回收的几个线程。

所以大家常说的 **Node 是单线程的指的是 JavaScript 的执行是单线程的(开发者编写的代码运行在单线程环境中)**，但 Javascript 的宿主环境，无论是 Node 还是浏览器都是多线程的因为libuv中有线程池的概念存在的，libuv会通过类似线程池的实现来模拟不同操作系统的异步调用，这对开发者来说是不可见的。


> libuv提供跨平台能力，让Node可以在Linux和Windows系统上都能够运行。

### 优势

* 擅长处理I/O密集型任务
* 采用事件驱动、异步编程，为网络服务而设计

### 单线程弱点

* 无法利用多核CPU
* 错误会引起整个应用退出，应用健壮性值得考验
* 大量计算占用CPU导致无法继续调用异步I/O（回调函数是同步处理的哦）

Node如何解决上述问题呢？子进程---`child process`

#### 子进程

* **子进程**的出现，意味着Node可以从容应对单线程的健壮性和无法利用多核CPU的问题。

* 通过将计算分发到各个子进程，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果，这样可以很好的保持应用模型的简单和低依赖。

* 通过Master-Worker的管理方式，也可以很好的管理各个工作进程，以达到更好的健壮性。

Node架构图如下：

![](https://images0.cnblogs.com/blog/311379/201310/07225741-e394258c0e4b40c4985e8c15b4655777.jpg)

